// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  //   provider             = "sqlite"
  provider             = "postgresql"
  // provider             = "mysql"
  url                  = env("VITE_DATABASE_URL")
  referentialIntegrity = "prisma"
}

model Convenio {
  id       Int        @id @default(autoincrement())
  nome     String
  Paciente Paciente[]
}

model Paciente {
  id             Int      @id @default(autoincrement())
  nome           String
  telefone       String
  responsavel    String
  dataNascimento String
  convenioId     Int
  disabled       Boolean  @default(false)
  createdAt      DateTime @default(now())

  convenio   Convenio?    @relation(fields: [convenioId], references: [id])
  vaga       Vaga?
  calendario Calendario[]
}

model Vaga {
  id             Int     @id @default(autoincrement())
  pacienteId     Int     @unique
  dataContato    String
  periodoId      Int
  tipoSessaoId   Int
  // especialidadeId Int
  statusId       Int
  observacao     String
  naFila         Boolean @default(true)
  dataSaiuFila   String?
  devolutiva     Boolean @default(false)
  dataDevolutiva String?
  diff           String?
  dataRetorno    String?

  createdAt DateTime @default(now())

  // especialidade Especialidade @relation(fields: [especialidadeId], references: [id])
  status         Status                @relation(fields: [statusId], references: [id])
  periodo        Periodo?              @relation(fields: [periodoId], references: [id])
  tipoSessao     TipoSessao?           @relation(fields: [tipoSessaoId], references: [id])
  paciente       Paciente?             @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  especialidades VagaOnEspecialidade[]
}

model VagaOnEspecialidade {
  agendado     Boolean @default(false)
  dataAgendado String?
  vaga         Vaga    @relation(fields: [vagaId], references: [id], onDelete: Cascade)
  vagaId       Int // relation scalar field (used in the `@relation` attribute above)

  especialidade   Especialidade @relation(fields: [especialidadeId], references: [id])
  especialidadeId Int // relation scalar field (used in the `@relation` attribute above)

  @@id([vagaId, especialidadeId])
}

model Periodo {
  id   Int    @id @default(autoincrement())
  nome String
  vaga Vaga[]
}

model Especialidade {
  id         Int                   @id @default(autoincrement())
  nome       String
  cor        String                @default("#000000")
  vagas      VagaOnEspecialidade[]
  Funcao     Funcao[]
  calendario Calendario[]
  Terapeuta  Terapeuta[]
}

model Status {
  id   Int    @id @default(autoincrement())
  nome String
  vaga Vaga[]
}

model TipoSessao {
  id   Int    @id @default(autoincrement())
  nome String
  vaga Vaga[]
}

model Usuario {
  id        Int      @id @default(autoincrement())
  nome      String
  login     String   @unique
  senha     String
  ativo     Boolean  @default(true)
  perfilId  Int
  createdAt DateTime @default(now())

  perfil     Perfil       @relation(fields: [perfilId], references: [id])
  calendario Calendario[]
  terapeuta  Terapeuta?
}

model Perfil {
  id      Int       @id @default(autoincrement())
  nome    String
  Usuario Usuario[]
}

model Localidade {
  id         Int          @id @default(autoincrement())
  casa       String
  sala       String
  ativo      Boolean      @default(true)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  calendario Calendario[]
}

model StatusEventos {
  id         Int          @id @default(autoincrement())
  nome       String
  ativo      Boolean      @default(true)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  calendario Calendario[]
}

model Frequencia {
  id         Int          @id @default(autoincrement())
  nome       String
  ativo      Boolean      @default(true)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  calendario Calendario[]
}

model Modalidade {
  id         Int          @id @default(autoincrement())
  nome       String
  ativo      Boolean      @default(true)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  calendario Calendario[]
}

model Intervalo {
  id         Int          @id @default(autoincrement())
  nome       String
  ativo      Boolean      @default(true)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  calendario Calendario[]
}

model Funcao {
  id              Int      @id @default(autoincrement())
  nome            String
  especialidadeId Int
  ativo           Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now())

  especialidade Especialidade @relation(fields: [especialidadeId], references: [id])
  calendario    Calendario[]

  terapeutas terapeutaOnFuncao[]
}

model Terapeuta {
  id              Int     @id @default(autoincrement())
  usuarioId       Int     @unique
  especialidadeId Int
  fazDevolutiva   Boolean @default(true)

  usuario       Usuario?       @relation(fields: [usuarioId], references: [id])
  especialidade Especialidade? @relation(fields: [especialidadeId], references: [id])
  calendario    Calendario[]

  funcoes terapeutaOnFuncao[]
}

model terapeutaOnFuncao {
  terapeutaId Int
  funcaoId    Int

  terapeuta Terapeuta? @relation(fields: [terapeutaId], references: [id], onDelete: Cascade)
  funcao    Funcao?    @relation(fields: [funcaoId], references: [id], onDelete: Cascade)

  @@id([terapeutaId, funcaoId])
}

model Calendario {
  id Int @id @default(autoincrement())

  dataInicio     String
  dataFim        String
  start          String
  end            String?
  diasFrequencia Int[]

  ciclo           String
  observacao      String
  pacienteId      Int
  modalidadeId    Int
  especialidadeId Int
  terapeutaId     Int
  funcaoId        Int
  localidadeId    Int
  statusEventosId Int
  frequenciaId    Int
  intervaloId     Int

  usuarioId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  terapeuta     Terapeuta     @relation(fields: [terapeutaId], references: [id])
  paciente      Paciente      @relation(fields: [pacienteId], references: [id])
  modalidade    Modalidade    @relation(fields: [modalidadeId], references: [id])
  especialidade Especialidade @relation(fields: [especialidadeId], references: [id])
  funcao        Funcao        @relation(fields: [funcaoId], references: [id])
  localidade    Localidade    @relation(fields: [localidadeId], references: [id])
  statusEventos StatusEventos @relation(fields: [statusEventosId], references: [id])
  frequencia    Frequencia    @relation(fields: [frequenciaId], references: [id])
  intervalo     Intervalo     @relation(fields: [intervaloId], references: [id])
  usuario       Usuario       @relation(fields: [usuarioId], references: [id])
}
